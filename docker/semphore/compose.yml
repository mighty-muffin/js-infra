---
name: ansible

networks: # docker network create proxy
  proxy:
    name: proxy
    driver: bridge
    driver_opts:
      com.docker.network.bridge.name: proxy
    external: true

services:
  ansible:
    container_name: ansible
    image: docker.io/semaphoreui/semaphore:v2.14.10
    restart: unless-stopped
    networks:
      - proxy
    environment:
      - SEMAPHORE_ADMIN_EMAIL= ${SEMAPHORE_ADMIN_EMAIL}
      - SEMAPHORE_ADMIN_NAME= ${SEMAPHORE_ADMIN_NAME}
      - SEMAPHORE_ADMIN_PASSWORD= ${SEMAPHORE_ADMIN_PASSWORD}
      - SEMAPHORE_ADMIN= ${SEMAPHORE_ADMIN}
      - SEMAPHORE_DB_DIALECT= ${SEMAPHORE_DB_DIALECT}
    volumes:
      - "./config:/etc/semaphore"
      - "./db:/var/lib/semaphore"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.ansible.entrypoints=https"
      - "traefik.http.routers.ansible.rule=Host(`ansible.local.irishlab.io`)"
      - "traefik.http.routers.ansible.service=ansible"
      - "traefik.http.routers.ansible.tls=true"
      - "traefik.http.services.ansible.loadbalancer.server.port=3000"
