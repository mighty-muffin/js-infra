---
name: semaphore

networks: # docker network create proxy
  proxy:
    name: proxy
    driver: bridge
    driver_opts:
      com.docker.network.bridge.name: proxy
    external: true

services:
  semaphore:
    container_name: semaphore
    image: docker.io/semaphoreui/semaphore:v2.15.0
    restart: unless-stopped
    # networks:
    #   - proxy
    ports:
      - 3000:3000
    environment:
      - SEMAPHORE_ADMIN_EMAIL= ${SEMAPHORE_ADMIN_EMAIL}
      - SEMAPHORE_ADMIN_NAME= ${SEMAPHORE_ADMIN_NAME}
      - SEMAPHORE_ADMIN_PASSWORD= ${SEMAPHORE_ADMIN_PASSWORD}
      - SEMAPHORE_ADMIN= ${SEMAPHORE_ADMIN}
      - SEMAPHORE_DB_DIALECT= ${SEMAPHORE_DB_DIALECT}
    volumes:
      - "./config:/etc/semaphore"
      - "./db:/var/lib/semaphore"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.semaphore.entrypoints=https"
      - "traefik.http.routers.semaphore.rule=Host(`semaphore.local.mighty-muffin.io`)"
      - "traefik.http.routers.semaphore.service=semaphore"
      - "traefik.http.routers.semaphore.tls=true"
      - "traefik.http.services.semaphore.loadbalancer.server.port=3000"
